<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego de la pelota - Espacio</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      flex-direction: column;
      font-family: 'Arial', sans-serif;
      color: #fff;
    }
    canvas {
      background-color: transparent;
      border: 2px solid #fff;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
      margin-top: 60px;
    }
    .game-over, .score {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      font-family: 'Arial', sans-serif;
      color: #fff;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
    }
    .game-over {
      top: 20px;
      font-size: 36px;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    .score {
      top: 10px;
      font-size: 20px;
      z-index: 10;
    }
    .game-over button {
      background-color: #FF6F00;
      color: white;
      font-size: 22px;
      border: none;
      padding: 15px 30px;
      margin-top: 20px;
      cursor: pointer;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    .game-over button:hover {
      background-color: #FF8C00;
      transform: scale(1.1);
    }
    .game-over button:active {
      transform: scale(1);
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="500"></canvas>
  <div id="gameOverMessage" class="game-over" style="display: none;">
    <p>¡Game Over!</p>
    <p>Puntuación: <span id="finalScore"></span></p>
    <button id="restartButton">Reiniciar Juego</button>
  </div>
  <div id="scoreDisplay" class="score">Puntuación: 0</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Cargar imágenes para la pelota y los obstáculos
    const ballImage = new Image();
    const obstacleImages = [
      new Image(), // Imagen 1 del obstáculo
      new Image(), // Imagen 2 del obstáculo
      new Image(), // Imagen 3 del obstáculo
      new Image()  // Imagen 4 del obstáculo
    ];
    
    // Especificar las rutas de las imágenes en la carpeta "imagenes"
    ballImage.src = "imagenes/pelota.png"; // Reemplaza con la ruta de tu imagen para la pelota
    obstacleImages[0].src = "imagenes/obstaculo1.png"; // Imagen 1 del obstáculo
    obstacleImages[1].src = "imagenes/obstaculo2.png"; // Imagen 2 del obstáculo
    obstacleImages[2].src = "imagenes/obstaculo3.png"; // Imagen 3 del obstáculo
    obstacleImages[3].src = "imagenes/obstaculo4.png"; // Imagen 4 del obstáculo

    // Esperamos a que las imágenes se carguen antes de iniciar el juego
    let imagesLoaded = false;
    ballImage.onload = function() {
      if (obstacleImages.every(img => img.complete)) {
        imagesLoaded = true;
        draw(); // Llamamos a la función de dibujo después de cargar las imágenes
      }
    };

    // Variables del juego
    const ballRadius = 20;
    const pathWidth = canvas.width / 3;
    const totalPaths = 3;
    let ballX = canvas.width / 2;
    let ballY = canvas.height - 50;
    let currentLane = 1; // La pelota comienza en el carril del medio (índice 1)
    let score = 0;

    const obstacleWidth = pathWidth - 10;
    const obstacleHeight = 30;
    const obstacleSpeed = 4;
    let obstacles = [];

    // Variables para las estrellas en el fondo
    const stars = [];
    const starSpeed = 0.2; // Ajuste de velocidad de las estrellas

    // Función para generar estrellas de fondo
    function generateStars() {
      for (let i = 0; i < 100; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const radius = Math.random() * 2 + 1;
        stars.push({ x, y, radius });
      }
    }

    // Función para mover las estrellas
    function moveStars() {
      for (let i = 0; i < stars.length; i++) {
        stars[i].y += starSpeed;
        if (stars[i].y > canvas.height) {
          stars[i].y = 0; // Volver a colocar la estrella arriba si se sale por abajo
        }
      }
    }

    // Función para dibujar el fondo (estrellas)
    function drawBackground() {
      ctx.fillStyle = "#ffffff";
      for (let i = 0; i < stars.length; i++) {
        ctx.beginPath();
        ctx.arc(stars[i].x, stars[i].y, stars[i].radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Función para generar obstáculos
    function generateObstacle() {
      const lane = Math.floor(Math.random() * totalPaths);
      const obstacleX = lane * pathWidth + 5;
      const obstacleSkin = Math.floor(Math.random() * obstacleImages.length); // Selección aleatoria de skin
      obstacles.push({
        x: obstacleX,
        y: 0,
        width: obstacleWidth,
        height: obstacleHeight,
        image: obstacleImages[obstacleSkin] // Asignamos una imagen aleatoria
      });
    }

    // Función para dibujar la pelota
    function drawBall() {
      ctx.drawImage(ballImage, ballX - ballRadius, ballY - ballRadius, ballRadius * 2, ballRadius * 2);
    }

    // Función para dibujar obstáculos
    function drawObstacles() {
      for (let i = 0; i < obstacles.length; i++) {
        let o = obstacles[i];
        ctx.drawImage(o.image, o.x, o.y, o.width, o.height);
      }
    }

    // Función para mover los obstáculos
    function moveObstacles() {
      for (let i = 0; i < obstacles.length; i++) {
        let o = obstacles[i];
        o.y += obstacleSpeed;
        if (o.y > canvas.height) {
          obstacles.splice(i, 1);
          score++;
        }
      }
    }

    // Función para detectar colisiones
    function detectCollisions() {
      for (let i = 0; i < obstacles.length; i++) {
        let o = obstacles[i];
        if (
          ballY - ballRadius < o.y + o.height &&
          ballY + ballRadius > o.y &&
          ballX + ballRadius > o.x &&
          ballX - ballRadius < o.x + o.width
        ) {
          endGame();
        }
      }
    }

    // Función para actualizar la posición de la pelota
    function updateBallPosition() {
      ballX = (currentLane * pathWidth) + pathWidth / 2;
    }

    // Función para dibujar el juego
    function draw() {
      if (!imagesLoaded) {
        return; // Esperamos a que las imágenes estén cargadas
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      moveStars();
      drawBackground();
      drawBall();
      drawObstacles();
      moveObstacles();
      detectCollisions();
      updateBallPosition();

      if (Math.random() < 0.02) {
        generateObstacle();
      }

      document.getElementById('scoreDisplay').textContent = "Puntuación: " + score;

      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(pathWidth, 0);
      ctx.lineTo(pathWidth, canvas.height);
      ctx.moveTo(pathWidth * 2, 0);
      ctx.lineTo(pathWidth * 2, canvas.height);
      ctx.stroke();

      if (!gameOver) {
        requestAnimationFrame(draw);
      }
    }

    // Función para finalizar el juego
    function endGame() {
      gameOver = true;
      document.getElementById('gameOverMessage').style.display = 'block';
      document.getElementById('finalScore').textContent = score;
    }

    // Función para reiniciar el juego
    function restartGame() {
      gameOver = false;
      score = 0;
      obstacles = [];
      stars.length = 0; // Limpiar las estrellas
      generateStars(); // Generar nuevas estrellas
      ballX = canvas.width / 2;
      ballY = canvas.height - 50;
      currentLane = 1; // Volver al carril medio
      draw(); // Volver a dibujar el juego
    }

    // Inicialización del juego
    let gameOver = false;
    generateStars(); // Inicializamos las estrellas al comenzar el juego
    draw();

    // Eventos de teclado para mover la pelota
    document.addEventListener('keydown', (event) => {
      if (gameOver) return;
      if (event.key === "ArrowLeft" || event.key === "a") {
        if (currentLane > 0) currentLane--;
      }
      if (event.key === "ArrowRight" || event.key === "d") {
        if (currentLane < totalPaths - 1) currentLane++; 
      }
    });

    // Botón para reiniciar el juego
    document.getElementById('restartButton').addEventListener('click', restartGame);

  </script>
</body>
</html>
